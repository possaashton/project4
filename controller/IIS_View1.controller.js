sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast"],function(e,o){"use strict";return e.extend("project2.controller.IIS_View1",{onInit:function(){ MessageToast.show('Hello World123'); },onUpdateUser:async function(){
MessageToast.show('Hello World2'); const e=this._frmValidation();if(!e)return;try{const e="manager";const n="B1Admin";const t=this.byId("mcbDBSelector").getSelectedKeys();for(const s of t){const t={CompanyDB:s,UserName:e,Password:n};const a=await this._login(t);if(!a)continue;const r=await this._getUser(a);if(!r)continue;await this._updateUser(a,r);o.show(`User updated in ${s}`)}}catch(e){console.error(e);o.show("Error: "+e.message)}},_frmValidation:function(){if(this.byId("ipUserCode").getValue()===""||this.byId("ipUserName").getValue()===""){o.show("UserCode/UserName cannot be blank");return false}if(this.byId("mcbDBSelector").getSelectedKeys().length===0){o.show("Please select at least one Database");return false}return true},_login:async function(e){const n=await fetch("/b1s/v1/Login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});const t=await n.json();if(!n.ok||t.error){o.show(`Login failed for ${e.CompanyDB}`);return null}return t.SessionId},_getUser:async function(e){const n=this.byId("ipUserCode").getValue();const t=await fetch(`/b1s/v1/Users?$filter=UserCode eq '${n}'`,{method:"GET",headers:{"Content-Type":"application/json","B1S-Session":e}});if(!t.ok){o.show("User lookup failed");return null}const s=await t.json();if(!s.value||s.value.length===0){o.show(`User '${n}' not found`);return null}return s.value[0]},_updateUser:async function(e,o){const n=o.InternalKey;const t=this.byId("ipUserName").getValue();const s=await fetch(`/b1s/v1/Users(${n})`,{method:"PATCH",headers:{"Content-Type":"application/json","B1S-Session":e},body:JSON.stringify({UserName:t})});if(!s.ok){throw new Error(`User update failed in DB ${o.DbName||""}`)}},frmValidation:async function(){if(this.byId("ipUserCode").getValue()==""||this.byId("ipUserName").getValue()==""){console.log("UserCode/UserName Cannot be blank");o.show("UserCode/UserName Cannot be blank");return false}var e=this.byId("mcbDBSelector").getSelectedKeys();if(e.length==0){console.log("Databases/User Authorizations Cannot be blank");o.show("Databases/User Authorizations Cannot be blank");return false}return true},testMultiDBUserFetch:async function(){const e="manager";const o="B1Admin";const n="manager";const t=["SBODemoUS","SBODemoGB"];const s={SBODemoUS:"B1S_US",SBODemoGB:"B1S_GB"};for(const a of t){const t=s[a];if(!t){console.warn(`No destination configured for ${a}`);continue}try{const s=await fetch(`/destinations/${t}/b1s/v1/Login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({CompanyDB:a,UserName:e,Password:o})});const r=await s.json();if(!s.ok||r.error||!r.SessionId){console.error(`Login failed for ${a}`,r);continue}const i=r.SessionId;console.log(`Logged into ${a}, SessionId: ${i}`);const c=await fetch(`/destinations/${t}/b1s/v1/Users?$filter=UserCode eq '${n}'`,{method:"GET",headers:{"Content-Type":"application/json","B1S-Session":i}});const l=await c.json();if(!l.value||l.value.length===0){console.warn(`User '${n}' not found in ${a}`)}else{console.log(`User in ${a}:`,l.value[0])}await fetch(`/destinations/${t}/b1s/v1/Logout`,{method:"POST",headers:{"B1S-Session":i}})}catch(e){console.error(`Error processing DB ${a}:`,e)}}}})});
//# sourceMappingURL=IIS_View1.controller.js.map